
# Generative Shadow Synthesis and Removal for Remote Sensing Images

This is the official PyTorch implementation of the paper:

**C. Shao, H. Li and H. Shen, "Generative Shadow Synthesis and Removal for Remote Sensing Images Through Embedding Illumination Models," in IEEE Transactions on Geoscience and Remote Sensing, vol. 63, pp. 1-15, 2025, Art no. 5620115, doi: **[**10.1109/TGRS.2025.3561307**](https://doi.org/10.1109/TGRS.2025.3561307)**.**
[PaperLink](https://ieeexplore.ieee.org/document/10967107)

We also provide the pretrained models and datasets for both shadow synthesis (GSSNet) and shadow removal (GSRNet) tasks.

- **AISD Dataset**: [Baidu Wangpan Link](https://pan.baidu.com/s/19AtO2Y7r5wDZs0PQgA5eug) (password: mhxt)
- **RS_SynShadow Dataset**: [Baidu Wangpan Link](https://pan.baidu.com/s/1iKLqdXszWA9wjqGS_S7h7A?pwd=n4vd)
- **Pretrained Models**: [Baidu Wangpan Link](https://pan.baidu.com/s/1l7E_-O6QMoDE_fk4E7_O1A?pwd=evpn) 


---

## 🔧 Environment and Installation

- Python >= 3.6  
- PyTorch >= 1.10 (with CUDA support recommended)  
- OpenCV  
- Pillow (PIL)
- Scipy

Install required packages:

```bash
pip install -r requirements.txt
```

---

## 📁 Project Structure

```
├── checkpoints/            # Saved models (auto-generated during training)
├── data/                   # Dataset loading and processing scripts
├── datasets/               # Training and test images
├── models/                 # Model definitions for GSS and GSR
├── options/                # Training and testing options
├── results/                # Shadow removal results
├── util/                   # Utilities for visualization and processing
├── train_GSS.py            # Training script for shadow synthesis
├── test_GSS.py             # Testing script for shadow synthesis
├── train_GSR.py            # Training script for shadow removal
├── test_GSR.py             # Testing script for shadow removal
└── README.md               # Project documentation
```

---

## 🌑 Shadow Synthesis (GSSNet)

### 4.1 Dataset Preparation
Use the synthetic shadow dataset generated by the GSS model. Organize it as follows:
```
datasets/
└── AISD/
    ├── shadow/       # Shadow images
    └── mask/         # Shadow masks
```

### 4.2 Train GSSNet
Run the following command to train the GSS model:
```bash
python train_GSS.py     --dataroot ./datasets/AISD     --name AISD_GSSNet     --model GSS     --custom_dataset_size 1000     --syn_crop_size 256
```

**Parameter Explanation:**

- `--dataroot`: path to dataset  
- `--name`: experiment name (used for checkpoints)  
- `--custom_dataset_size`: number of training/test samples in one epoch  
- `--syn_crop_size`: patch size for training/test  

### 4.3 Test GSSNet
To test the GSS model and generate synthetic shadow images for training the GSR model, run:
```bash
python test_GSS.py     --dataroot ./datasets/AISD     --name AISD_GSSNet     --model test_GSS     --results_dir ./datasets/RS_SynShadow     --custom_dataset_size 5149     --syn_crop_size 256
```
The results will be saved in the ./datasets/RS_SynShadow directory.<hr></hr>
Pretrained model for GSSNet can be downloaded from [model link placeholder] and placed in:

```
checkpoints/AISD_GSSNet/
```

---

## ☀️ Shadow Removal (GSRNet)

### 5.1 Dataset Preparation

You may skip shadow synthesis if you have run the test_GSS.py command or use our prepared dataset RS_Synshadow, which can be downloaded from [https://pan.baidu.com/s/1iKLqdXszWA9wjqGS_S7h7A?pwd=n4vd]:

```
datasets/
└── RS_SynShadow/
    ├── shadow/         # Synthetic shadow images
    ├── mask/           # Corresponding masks
    └── shadowfree/     # Shadow-free images

Test dataset example:
datasets/
└── test_RS_SynShadow/
    ├── shadow/
    ├── mask/
    └── shadowfree/     # Optional
```

Custom datasets should follow the same folder structure.

### 5.2 Train GSRNet
Run the following command to train the GSR model:
```bash
python train_GSR.py     --dataroot ./datasets/RS_SynShadow     --name AISD_GSRNet     --model GSR
```

### 5.3 Test GSRNet
To test the GSR model and evaluate its performance, run:
```bash
python test_GSR.py     --dataroot ./datasets/test_RS_SynShadow     --name AISD_GSRNet     --model test_GSR
```
The results will be saved in the ./results directory. If you want to reproduce the AISD test results in the paper, it is recommended that you resize all images to 512*512 (--preprocess resize --load_size 512). <hr></hr>
Pretrained model for GSRNet can be downloaded from [model link placeholder] and placed in:

```
checkpoints/AISD_GSRNet/
```

---

### Optional: Generate Custom Attenuation Parameters

If you want to use a custom shadow triplet dataset to generate the attenuation parameters (`parameters.txt`) required for GSS-Net shadow synthesis, you can run the `compute_param.py` script independently:

```bash
python compute_param.py
```

## ⚠️ Notes

- Ensure datasets are correctly aligned and normalized before training.  
- Models are sensitive to lighting distribution; ensure consistent preprocessing.  
- CUDA is highly recommended for efficiency.  

---

## 📄 Citation

If you find this project helpful, please cite our work:

```bibtex
@article{shao2025generative,
  title={Generative Shadow Synthesis and Removal for Remote Sensing Images Through Embedding Illumination Models},
  author={Shao, Chenglin and Li, Huifang and Shen, Huanfeng},
  journal={IEEE Transactions on Geoscience and Remote Sensing},
  volume={63},
  pages={1--15},
  year={2025},
  doi={10.1109/TGRS.2025.3561307}
}
```

---

## 📬 Contact

For questions or suggestions, feel free to open an issue or contact the authors.

---

Enjoy high-fidelity shadow-free remote sensing! 🌍
